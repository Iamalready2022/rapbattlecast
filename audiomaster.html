<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Audio Master Control V6.0</title>
    <style>
        body {
            background: #121212;
            color: white;
            font-family: sans-serif;
            text-align: center;
        }

        #recIndicator {
            width: 60px;
            height: 60px;
            background: #333;
            margin: 20px auto;
            border-radius: 10px;
            transition: 0.3s;
        }

        .active {
            background: #ff0000 !important;
            box-shadow: 0 0 20px #ff0000;
        }

        button {
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px;
            border-radius: 5px;
            border: none;
        }

        #startBtn {
            background: #2ecc71;
            color: white;
        }

        #stopBtn {
            background: #e74c3c;
            color: white;
        }
    </style>
</head>

<body>

    <h1>Audio Master Control V6.0</h1>
    <div id="recIndicator"></div>

    <button id="startBtn">START RECORDING</button>
    <button id="stopBtn">STOP & SAVE</button>

    <script>
        let mediaRecorder;
        let audioChunks = [];

        // High Priority Audio Context
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)({
            latencyHint: 'interactive', // Tells Chrome to prioritize speed
            sampleRate: 44100
        });

        const recIndicator = document.getElementById('recIndicator');

        async function startRecording() {
            audioChunks = [];
            const stream = await navigator.mediaDevices.getUserMedia({
                audio: {
                    echoCancellation: false,
                    noiseSuppression: false,
                    autoGainControl: false // Prevents Windows/Chrome from "fighting" your volume
                }
            });

            // V5.9 Stability: 4096 Buffer
            const source = audioCtx.createMediaStreamSource(stream);
            const processor = audioCtx.createScriptProcessor(4096, 2, 2);

            mediaRecorder = new MediaRecorder(stream);

            mediaRecorder.ondataavailable = (event) => {
                audioChunks.push(event.data);
            };

            mediaRecorder.onstop = () => {
                const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                const url = URL.createObjectURL(audioBlob);

                // V6.0 "Safety Net" Naming Logic
                let fileName = prompt("Enter file name:", "");

                if (fileName === null || fileName.trim() === "") {
                    // Default if you are in a hurry
                    const date = new Date().toLocaleDateString().replace(/\//g, '-');
                    fileName = `AudioMaster_V6_${date}`;
                }

                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `${fileName}.wav`;
                document.body.appendChild(a);
                a.click(); // Automatically triggers the save

                recIndicator.classList.remove('active');
            };

            mediaRecorder.start();
            recIndicator.classList.add('active');
        }

        document.getElementById('startBtn').onclick = () => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            startRecording();
        };

        document.getElementById('stopBtn').onclick = () => {
            mediaRecorder.stop();
        };
    </script>
</body>

</html>